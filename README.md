# 总控制器实现方案

## 一、数据定义

### 1.1 座椅旋转位置定义

```c
typedef enum {
    /* 单个座椅旋转方向 */
    G_SEAT_ZHENGQIAN      = 0x50,  // 面向前
    G_SEAT_ZHENGHOU       = 0x51,  // 面向后
    G_SEAT_GUODAO         = 0x52,  // 面向过道
    G_SEAT_1WEIDUAN       = 0x53,  // 面向一位端
    G_SEAT_2WEIDUAN       = 0x54,  // 面向二位端

    /* 全部座椅旋转 */
    G_SEAT_ALL_1WEIDUAN   = 0x40,  // 一位端
    G_SEAT_ALL_2WEIDUAN   = 0x41,  // 二位端
    G_SEAT_ALL_ZHENGQIAN  = 0x42,  // 正前
    G_SEAT_ALL_ZHENGHOU   = 0x43,  // 正后

    /* 会议模式 */
    G_SEAT_MEETING_6REN   = 0x80,  // 六人会议

    /* 两人会客 */
    G_SEAT_NUM_1A_2A      = 0x00,
    G_SEAT_NUM_2A_3A      = 0x01,
    G_SEAT_NUM_1F_2F      = 0x10,
    G_SEAT_NUM_2F_3F      = 0x11,
    G_SEAT_NUM_1A_1F      = 0x20,
    G_SEAT_NUM_2A_2F      = 0x21,
    G_SEAT_NUM_3A_3F      = 0x22,

    /* 四人会客 */
    G_SEAT_NUM_1A_2A_1F_2F = 0x30,
    G_SEAT_NUM_2A_3A_2F_3F = 0x31,

} G_SEAT_ROTATE_CMD_T;
```

### 1.2 呼叫定义 (1字节)

| bit  | 座椅 | 值   |
|------|------|------|
| bit0 | 座椅1 | 0x01 |
| bit1 | 座椅2 | 0x02 |
| bit2 | 座椅3 | 0x04 |
| bit3 | 座椅4 | 0x08 |
| bit4 | 座椅5 | 0x10 |
| bit5 | 座椅6 | 0x20 |

/*座椅状态*/
typedef enum{
    G_SEAT_CMD_REST = 0X00,//复位
    G_SEAT_CMD_RUN = 0X01,//运行
    G_SEAT_CMD_ERROR = 0X02,//错误
} G_SEAT_STATUS_T;

---

## 二、通讯协议

### 2.1 帧格式

```
帧头    长度  地址  命令  寄存器  数据1  数据2  数据3  数据4  校验  帧尾
7B 7B   09    10    03    01      00     00     00     00     0F    7D 7D
[0-1]   [2]   [3]   [4]   [5]     [6]    [7]    [8]    [9]    [10]  [11-12]
```

说明:
- 长度: 去除帧头帧尾后所有数据的长度
- 命令: 03=读, 06=写, 09=其他
- 寄存器: 实际指令定义

### 2.2 寄存器定义

| 命令 | 寄存器 | 功能 | 数据说明 |
|------|--------|------|----------|
| 03 | 0x01 | 读取座椅旋转状态 | 数据4=G_SEAT_STATUS_T |
| 03 | 0x02 | 读取呼叫状态 | 数据4=呼叫位定义 |
| 03 | 0x03 | 读取氛围灯状态 | 数据4: 0=关, 1=开 |
| 06 | 0x30 | 控制座椅旋转 | 数据4=G_SEAT_ROTATE_CMD_T |
| 06 | 0x31 | 座椅复位(回到坐姿) | 数据4=座椅编号(0=全部) |
| 06 | 0x32 | 清除呼叫 | 数据4=呼叫位定义(清除对应位) |
| 06 | 0x33 | 控制氛围灯 | 数据4: 0=关, 1=开 |
| 06 | 0x34 | 座椅急停 | 无 |

---

## 三、通讯流程

### 3.1 PIS → 总控

1. 旋转功能: 发送座椅旋转指令，接收反馈
2. 呼叫功能: 发送清除呼叫指令，接收反馈
3. 氛围灯: 发送开关指令，接收反馈

### 3.2 总控 → PIS

1. 旋转反馈
2. 呼叫反馈
3. 氛围灯反馈

### 3.3 总控 → 边柜控制器

1. 座椅旋转
   - 发送回到坐姿/旋转指令
   - 接收状态(正在动作/动作异常/动作完成)
2. 呼叫: 轮询查询6个座椅呼叫状态
3. 氛围灯: 设置开关

### 3.4 边柜控制器 → 总控

1. 座椅旋转状态反馈
2. 呼叫状态反馈
3. 氛围灯状态反馈

---

## 四、调试(大彩屏)

1. 旋转控制页面
   - 单个座椅旋转方向
   - 全部座椅旋转
   - 会议模式
   - 两人/四人会客

2. 呼叫页面
   - 显示呼叫状态
   - 清除呼叫
